<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Racing AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#111827">
</head>
<body class="bg-gray-950 text-white min-h-screen pb-20">
    <div class="max-w-2xl mx-auto p-4">

        <h1 class="text-3xl font-bold mb-8 flex items-center gap-3">ğŸ‡ Racing AI Live</h1>

        <!-- Tabs -->
        <div class="flex gap-2 overflow-x-auto pb-4 mb-8 border-b border-gray-700">
            <button onclick="showTab(0)" class="tab-btn active px-6 py-3 rounded-2xl font-medium flex-shrink-0">ğŸŒŸ Pick of the Day</button>
            <button onclick="showTab(1)" class="tab-btn px-6 py-3 rounded-2xl font-medium flex-shrink-0">ğŸ”¥ Today's Best</button>
            <button onclick="showTab(2)" class="tab-btn px-6 py-3 rounded-2xl font-medium flex-shrink-0">ğŸ“… Tomorrow's Best</button>
            <button onclick="showTab(3)" class="tab-btn px-6 py-3 rounded-2xl font-medium flex-shrink-0">ğŸ‘€ Look at These</button>
            <button onclick="showTab(4)" class="tab-btn px-6 py-3 rounded-2xl font-medium flex-shrink-0">ğŸš© Anomalies</button>
        </div>

        <!-- Content -->
        <div id="content" class="space-y-6"></div>

        <!-- Refresh -->
        <div class="fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-700 p-4 max-w-2xl mx-auto">
            <button onclick="refreshAll()" class="w-full py-4 bg-emerald-600 text-white font-bold rounded-3xl flex items-center justify-center gap-3 active:scale-95">
                ğŸ”„ Refresh All Data
            </button>
        </div>
    </div>

    <script>
        let currentTab = 0;
        const tabNames = ["pick_of_day", "today_best", "tomorrow_best", "look_at_these", "anomalies"];

        function renderCards(items) {
            const container = document.getElementById('content');
            container.innerHTML = '';
            if (items.length === 0) {
                container.innerHTML = `<p class="text-center text-gray-400 py-12">No data yet. Tap Refresh.</p>`;
                return;
            }
            items.forEach(item => {
                const card = document.createElement('div');
                card.className = `bg-gray-900 rounded-3xl p-6 ${item.highlighted ? 'ring-2 ring-green-500' : ''}`;
                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-green-400 font-medium">${item.time || 'TBD'}</span>
                            <span class="ml-3 text-xs opacity-60">${item.track || 'Various'}</span>
                        </div>
                        <div class="text-right">
                            <div class="text-3xl font-bold">${item.odds || 'TBD'}</div>
                            <div class="text-emerald-400 text-sm">AI ${item.ai_score} â€¢ ${item.probability || '??'}%</div>
                        </div>
                    </div>
                    <div class="mt-4 text-2xl font-bold leading-tight">${item.horse}</div>
                    <div class="mt-3 text-sm opacity-90 leading-relaxed">${item.explanation}</div>
                `;
                container.appendChild(card);
            });
        }

        async function loadData() {
            try {
                const res = await fetch('/api/today');
                const data = await res.json();
                renderCards(data[tabNames[currentTab]] || []);
            } catch(e) {
                document.getElementById('content').innerHTML = `<p class="text-red-400">Error loading data. Tap Refresh.</p>`;
            }
        }

        async function refreshAll() {
            const btn = document.querySelector('button');
            btn.innerHTML = 'ğŸ”„ Scraping sites...';
            btn.disabled = true;

            await fetch('/api/scrape');
            await loadData();

            btn.innerHTML = 'ğŸ”„ Refresh All Data';
            btn.disabled = false;
        }

        function showTab(n) {
            currentTab = n;
            document.querySelectorAll('.tab-btn').forEach((b, i) => {
                b.classList.toggle('active', i === n);
                b.classList.toggle('bg-emerald-600', i === n);
                b.classList.toggle('text-white', i === n);
            });
            loadData();
        }

        // Initial load
        loadData();
    </script>
</body>
</html>
